{
  if (!rb.doFacets)   return;
  if ((sreq.purpose & ShardRequest.PURPOSE_GET_TOP_IDS) != 0) {
    sreq.purpose|=ShardRequest.PURPOSE_GET_FACETS;
    FacetInfo fi=rb._facetInfo;
    if (fi == null) {
      rb._facetInfo=fi=new FacetInfo();
      fi.parse(rb.req.getParams(),rb);
    }
    sreq.params.remove(FacetParams.FACET_MINCOUNT);
    sreq.params.remove(FacetParams.FACET_OFFSET);
    sreq.params.remove(FacetParams.FACET_LIMIT);
    sreq.params.remove(FacetParams.FACET_CROSS_OFFSET);
    sreq.params.remove(FacetParams.FACET_CROSS_LIMIT);
    int maxlimit=MdrillGroupBy.MAX_CROSS_ROWS;
    sreq.params.set(FacetParams.FACET_CROSS_OFFSET,0);
    sreq.params.set(FacetParams.FACET_CROSS_LIMIT,maxlimit);
  }
 else {
    sreq.params.set(FacetParams.FACET,"false");
  }
}
