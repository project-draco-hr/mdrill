{
  if (!rb.doFacets) {
    return;
  }
  SolrParams params=rb.req.getParams();
  String[] facetFs=params.getParams(FacetParams.FACET_FIELD);
  try {
    if (null != facetFs) {
      boolean isdetail=params.getBool(FacetParams.FACET_CROSS_DETAIL,false);
      Object res=this.getResult(isdetail,rb.req.getSearcher(),params,rb.req,facetFs,rb.getResults().docSet);
      rb.rsp.add("mdrill_data",res);
    }
 else {
      throw new Exception("null != facetFs");
    }
  }
 catch (  Throwable e) {
    LOG.error("getFacetCounts",e);
    throw new SolrException(ErrorCode.SERVER_ERROR,e);
  }
}
