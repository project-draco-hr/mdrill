{
synchronized (this) {
    int size=msg.getData().length;
    ByteBuffer bufsize=ByteBuffer.allocate(HEADSIZE);
    bufsize.putInt(size);
    ByteBuffer buf=ByteBuffer.allocate(size);
    buf.put(msg.getData());
    bufsize.rewind();
    this.append(bufsize);
    buf.rewind();
    return this.append(buf);
  }
}
