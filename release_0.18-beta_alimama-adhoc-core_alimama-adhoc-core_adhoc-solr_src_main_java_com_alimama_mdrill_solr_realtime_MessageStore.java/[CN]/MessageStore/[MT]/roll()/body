{
  final long newOffset=this.nextAppendOffset();
  final File newFile=new File(this.partitionDir,this.nameFromOffset(newOffset));
  this.segments.last().fileMessageSet.flush();
  this.segments.last().fileMessageSet.setMutable(false);
  this.segments.append(new Segment(newOffset,newFile,true));
  while (this.segments.view().length > this.getMaxSegmentsCount()) {
    this.segments.delete(this.segments.first());
  }
}
