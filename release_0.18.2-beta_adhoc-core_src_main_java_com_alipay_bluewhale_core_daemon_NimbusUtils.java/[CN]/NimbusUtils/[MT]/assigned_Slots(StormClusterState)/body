{
  Set<String> assignments=StormUtils.listToSet(stormClusterState.assignments(null));
  Map<String,Set<Integer>> rtn=null;
  if (assignments != null) {
    rtn=new HashMap<String,Set<Integer>>();
    for (Iterator<String> iter=assignments.iterator(); iter.hasNext(); ) {
      String topologyid=(String)iter.next();
      Assignment assignment=stormClusterState.assignment_info(topologyid,null);
      if (assignment == null) {
        continue;
      }
      Map<Integer,NodePort> taskNodePort=assignment.getTaskToNodeport();
      if (taskNodePort != null) {
        Set<Entry<Integer,NodePort>> entrySet=taskNodePort.entrySet();
        for (Iterator<Entry<Integer,NodePort>> it=entrySet.iterator(); it.hasNext(); ) {
          Entry<Integer,NodePort> entry=it.next();
          NodePort np=entry.getValue();
          if (!rtn.containsKey(np.getNode())) {
            Set<Integer> tmp=new HashSet<Integer>();
            tmp.add(np.getPort());
            rtn.put(np.getNode(),tmp);
          }
 else {
            Set<Integer> ports=rtn.get(np.getNode());
            ports.add(np.getPort());
          }
        }
      }
    }
  }
  return rtn;
}
