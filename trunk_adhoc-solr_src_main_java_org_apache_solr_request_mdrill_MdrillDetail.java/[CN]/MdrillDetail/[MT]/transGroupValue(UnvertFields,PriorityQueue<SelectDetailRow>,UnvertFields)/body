{
  TermNumToString[] tm=this.prefetchValues(ufs,res,sortufs);
  PriorityQueue<SelectDetailRow> topItems=new PriorityQueue<SelectDetailRow>(this.parse.limit_offset,Collections.reverseOrder(this.container.cmpresult));
  boolean usedsort=this.container.isOnlyColumnSort();
  for (  SelectDetailRow row : res) {
    int doc=row.docid;
    String sortString=null;
    if (usedsort) {
      sortString=tm[ufs.length].getTermValueWithNull((int)row.value);
    }
    SortGroupVal buff=new SortGroupVal();
    buff.groupbuff.append("-");
    buff.groupbuff.append(UniqConfig.GroupJoinString());
    buff.groupbuff.append("-");
    for (int i=0; i < ufs.length; i++) {
      buff.groupbuff.append(UniqConfig.GroupJoinString());
      UnvertFile uf=ufs.cols[i];
      if (uf != null) {
        Integer termNum=uf.uif.termNum(doc);
        buff.groupbuff.append(EncodeUtils.encode(tm[i].getTermValue(termNum)));
      }
 else {
        buff.groupbuff.append(EncodeUtils.encode("-"));
      }
    }
    buff.sortString=sortString;
    this.setGroupJoin(buff,ufs.length,doc);
    SelectDetailRow newrow=SelectDetailRow.INSTANCE(doc,row.getCompareValue());
    newrow.setKey(buff.groupbuff.toString());
    newrow.colVal=buff.sortString;
    QueuePutUtils.put2QueueDetail(newrow,topItems,this.parse.limit_offset,this.container.cmpresult);
  }
  return topItems;
}
